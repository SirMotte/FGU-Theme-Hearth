<?xml version="1.0" encoding="utf-8"?>
<root>
	<!-- Source: campaign/template_campaign.xml -->
	<template name="button_imagewindow_sizeup">
		<button_window_sizeup>
			<anchored position="insidetopright" offset="60,24" />
		</button_window_sizeup>
	</template>
	<template name="button_ichat">
		<button_icon name="button_ichat">
			<anchored to="rightanchor" width="20" height="20">
				<top />
				<right relation="relative" offset="-5" postoffet="-5" />
			</anchored>
			<icon normal="content_chat" />
			<tooltip textres="record_chat" />
			<script>
				function onButtonPress()
					RecordShareManager.onShareButtonPressed(window);
				end
			</script>
		</button_icon>
	</template>

	<!-- Source: common/template_records.xml -->
	<template name="anchor_record_image_header_right">
		<genericcontrol name="rightanchor">
			<anchored height="0" width="0">
				<top offset="5" />
				<right offset="-50" />
			</anchored>
		</genericcontrol>
	</template>
	<template name="frame_record_content">
		<genericcontrol name="contentframe">
			<anchored>
				<top parent="header" anchor="bottom" offset="7" />
				<left offset="15" />
				<right offset="-20" />
				<bottom offset="-20" />
			</anchored>
			<disabled />
		</genericcontrol>
	</template>
	<template name="frame_record_content_tabbed">
		<genericcontrol name="contentframe">
			<anchored>
				<top parent="header" anchor="bottom" offset="7" />
				<left offset="15" />
				<right offset="-30" />
				<bottom offset="-20" />
			</anchored>
			<disabled />
		</genericcontrol>
	</template>
	<!--Image Window Background foreground-->
	<template name="imagedata_record_step">
		<imagedatacontrol>
			<invisible />
			<color>FFF0CA</color> <!-- Replaceable Color: Primary Foreground -->
			<backcolor>232323</backcolor> <!-- Replaceable Color: Primary Background -->
		</imagedatacontrol>
	</template>
	<template name="imagepaneldata_record_step">
		<imagedatacontrol>
			<invisible />
			<color>FFF0CA</color> <!-- Replaceable Color: Primary Foreground -->
			<backcolor>232323</backcolor> <!-- Replaceable Color: Primary Background -->
		</imagedatacontrol>
	</template>
	<!--Image Window Background foreground end-->
	<template name="string_record_name">
		<basicstring>
			<anchored>
				<top offset="2"/>
				<left offset="40" />
				<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
			</anchored>
			<font>reference-title</font>
			<multilinespacing>25</multilinespacing>
			<nodrag />
			<delaykeyupdate />
		</basicstring>
	</template>
	<template name="string_record_name_image">
		<string_record_name>
			<anchored height="25" merge="merge" />
			<multilinespacing merge="delete" />
		</string_record_name>
	</template>
	<template name="string_record_name_ref">
		<string_record_name>
			<anchored merge="merge">
				<right parent="" anchor="right" relation="absolute" offset="-25" />
			</anchored>
			<nodrag />
			<readonly />
		</string_record_name>
	</template>
	<template name="sub_note_header">
		<subwindow>
			<anchored>
				<top offset="3" />
				<left offset="15" />
				<right offset="-25" />
			</anchored>
			<activate />
			<fastinit />
		</subwindow>
	</template>

	<!-- Source: common/template_windows.xml -->
	<template name="button_window_sizedown">
		<button_window_sizedown_base>
			<anchored height="16" width="16" />
		</button_window_sizedown_base>
	</template>
	<template name="button_window_sizeup">
		<button_window_sizeup_base>
			<anchored height="16" width="16" />
		</button_window_sizeup_base>
	</template>
	<template name="close">
		<close_base>
			<anchored height="16" width="16">
				<top />
				<right />
			</anchored>
		</close_base>
	</template>
	<template name="close_calendar">
		<close>
			<anchored>
				<top offset="14" />
				<right offset="-12" />
			</anchored>
		</close>
	</template>
	<template name="close_campaignlist">
		<close>
			<anchored>
				<top offset="14" />
				<right offset="-4" />
			</anchored>
		</close>
	</template>
	<template name="close_charselect">
		<close>
			<anchored>
				<top offset="14" />
				<right offset="-12" />
			</anchored>
		</close>
	</template>
	<template name="close_partysheet">
		<close>
			<anchored>
				<top offset="13" />
				<right offset="-15" />
			</anchored>
		</close>
	</template>
	<template name="close_referencelist">
		<close>
			<anchored>
				<top offset="14" />
				<right offset="-12" />
			</anchored>
		</close>
	</template>
	<template name="close_referencepage">
		<close>
			<anchored>
				<top offset="7" />
				<right offset="-4" />
			</anchored>
		</close>
	</template>
	<template name="close_tokenbag">
		<close>
			<anchored>
				<top offset="14" />
				<right offset="-12" />
			</anchored>
		</close>
	</template>
	<template name="close_utilitybox">
		<close>
			<anchored>
				<top offset="13" />
				<right offset="-9" />
			</anchored>
		</close>
	</template>
	<template name="close_utilitybox2">
		<close>
			<anchored>
				<top offset="8" />
				<right offset="-9" />
			</anchored>
		</close>
	</template>
	<template name="close_utilitybox3">
		<close>
			<anchored>
				<top offset="14" />
				<right offset="-12" />
			</anchored>
		</close>
	</template>
	<template name="help">
		<help_base>
			<anchored height="16" width="16">
				<top />
				<right offset="-16" />
			</anchored>
		</help_base>
	</template>
	<template name="help_calendar">
		<help>
			<anchored>
				<top offset="14" />
				<right offset="-28" />
			</anchored>
		</help>
	</template>
	<template name="help_charselect">
		<help>
			<anchored>
				<top offset="14" />
				<right offset="-28" />
			</anchored>
		</help>
	</template>
	<template name="help_imagebox">
		<help>
			<anchored>
				<top offset="24" />
				<right offset="-44" />
			</anchored>
		</help>
	</template>
	<template name="help_imagepanel">
		<help>
			<anchored position="insidetopright" offset="17,1" />
			<invisible />
		</help>
	</template>
	<template name="help_partysheet">
		<help>
			<anchored>
				<top offset="13" />
				<right offset="-31" />
			</anchored>
		</help>
	</template>
	<template name="help_referencelist">
		<help>
			<anchored>
				<top offset="14" />
				<right offset="-28" />
			</anchored>
		</help>
	</template>
	<template name="help_tokenbag">
		<help>
			<anchored>
				<top offset="14" />
				<right offset="-28" />
			</anchored>
		</help>
	</template>
	<template name="help_utilitybox">
		<help>
			<anchored>
				<top offset="13" />
				<right offset="-25" />
			</anchored>
		</help>
	</template>
	<template name="help_utilitybox2">
		<help>
			<anchored>
				<top offset="8" />
				<right offset="-25" />
			</anchored>
		</help>
	</template>
	<template name="help_utilitybox3">
		<help>
			<anchored>
				<top offset="14" />
				<right offset="-28" />
			</anchored>
		</help>
	</template>
	<template name="sub_record_header">
		<subwindow>
			<anchored>
				<top offset="10" />
				<left offset="10" />
				<right offset="-25" />
			</anchored>
			<frame name="headergray" offset="5,5,20,5" />
			<activate />
			<fastinit />
		</subwindow>
	</template>
	<template name="tabs_partysheet">
		<buttongroup_tabs name="tabs">
			<anchored width="20" height="92">
				<top offset="50" />
				<right offset="-8" />
			</anchored>
		</buttongroup_tabs>
	</template>
    <template name="windowtitlebar">
        <genericcontrol>
			<anchored position="insidetop" offset="0,2" height="45" />
            <frame name="windowtitle" offset="30,0,30,0" />
            <script file="common/scripts/windowtitlebar.lua" />
        </genericcontrol>
    </template>

	<!-- Frame: utilitybox -->
	<template name="windowtitlebar_utilitybox">
		<windowtitlebar>
			<anchored offset="0,4" />
		</windowtitlebar>
	</template>
	<template name="windowmenubar_utilitybox">
		<windowmenubar>
			<anchored offset="-13,15" />
		</windowmenubar>
	</template>

	<!-- Frame: partysheet -->
	<template name="windowtitlebar_partysheet">
		<windowtitlebar>
			<anchored offset="0,3" />
		</windowtitlebar>
	</template>
	<template name="windowmenubar_partysheet">
		<windowmenubar>
			<anchored offset="-18,14" />
		</windowmenubar>
	</template>

	<!-- Frame: charselect -->
	<template name="windowtitlebar_charselect">
		<windowtitlebar>
			<anchored offset="0,4" />
		</windowtitlebar>
	</template>
	<template name="windowmenubar_charselect">
		<windowmenubar>
			<anchored offset="-16,15" />
		</windowmenubar>
	</template>

	<!-- Frame: tokenbag -->
	<template name="windowtitlebar_tokenbag">
		<windowtitlebar>
			<anchored offset="0,4" />
		</windowtitlebar>
	</template>
	<template name="windowmenubar_tokenbag">
		<windowmenubar>
			<anchored offset="-16,15" />
		</windowmenubar>
	</template>
    
	<!-- Frame: referencelist -->
	<template name="windowtitlebar_referencelist">
		<windowtitlebar>
			<anchored offset="0,4" />
		</windowtitlebar>
	</template>
	<template name="windowmenubar_referencelist">
		<windowmenubar>
			<anchored offset="-16,15" />
		</windowmenubar>
	</template>

    <!-- windowmenubar -->
    <template name="windowmenubar">
		<subwindow>
			<anchored position="insidetop" />
			<class>windowmenubar</class>
			<activate />
		</subwindow>
	</template>
	<windowclass name="windowmenubar">
		<script>
			function onInit()
				--WindowMenuManager.initMenuButtonBar(self);
			end
		</script>
		<sheetdata>
			<genericcontrol name="leftanchor">
				<anchored position="insidetopleft" height="16" /> <!-- Sized to Hearth icon size. -->
			</genericcontrol>
			<genericcontrol name="rightanchor">
				<anchored position="insidetopright" height="16" /> <!-- Sized to Hearth icon size. -->
			</genericcontrol>
            <!-- TODO: Quick fix to allow more time to do all the frames. -->
            <close>
                <anchored>
                    <top offset="0" />
                    <right offset="0" />
                </anchored>
            </close>
		</sheetdata>
	</windowclass>

	<!-- Frame: imagepanel -->
	<template name="close_imagepanel">
		<close>
			<anchored>
				<top offset="1" />
				<right offset="-2" />
			</anchored>
			<invisible />
		</close>
	</template>

	<!-- Frame: ctbox -->
	<template name="close_ctbox">
		<close>
			<anchored>
				<top offset="13" />
				<right offset="-5" />
			</anchored>
		</close>
	</template>
	<template name="help_ctbox">
		<help>
			<anchored>
				<top offset="13" />
				<right offset="-21" />
			</anchored>
		</help>
	</template>

	<!-- Frame: recordsheet -->
	<template name="close_recordsheet">
		<close>
			<anchored>
				<top offset="7" />
				<right offset="-8" />
			</anchored>
		</close>
	</template>

	<!-- Frame: charsheet -->
	<template name="close_charsheet">
		<close>
			<anchored>
				<top offset="14" />
				<right offset="-15" />
			</anchored>
		</close>
	</template>

	<!-- Frame: storybox (i.e. Story) -->
	<template name="close_storybox">
		<close>
			<anchored>
				<top offset="6" />
				<right offset="-8" />
			</anchored>
		</close>
	</template>

	<!-- Frame: imagebox -->
	<template name="close_imagebox">
		<close>
			<anchored>
				<top offset="24" />
				<right offset="-28" />
			</anchored>
		</close>
	</template>

	<!-- Frame: charsheethelper -->
	<template name="close_charsheethelper">
		<close>
			<anchored>
				<top offset="0" />
				<right offset="0" />
			</anchored>
		</close>
	</template>

	<!-- Source: ct/ct_host.xml-->
	<windowclass name="ct_effect" merge="join">
		<sheetdata>
			<string_ct_effect_source name="source">
				<color>DDDDDD</color> <!-- Replaceable Color: Secondary Foreground -->
			</string_ct_effect_source>
			<string_ct_effect_targets name="target_summary">
				<color>DDDDDD</color> <!-- Replaceable Color: Secondary Foreground -->
			</string_ct_effect_targets>
		</sheetdata>
	</windowclass>

	<!-- Source: ct/template_ct.xml -->
	<template name="label_ct">
		<label>
			<color>FFF0CA</color> <!-- Replaceable Color: Primary Foreground -->
		</label>
	</template>

	<!-- Source: desktop/desktop_classes.xml -->
	<windowclass name="dicetower" merge="join">
		<sizelimits>
			<minimum width="100" height="90" />
		</sizelimits>
		<sheetdata>
			<genericcontrol name="base">
				<bounds>0,0,100,90</bounds>
			</genericcontrol>
		</sheetdata>
	</windowclass>

	<!-- Source: desktop/desktop_panels.xml -->
	<panel name="dicetower" modes="host,client" merge="join">
		<anchored height="100" width="100" />
	</panel>
	
	<!-- Source: desktop/template_desktop.xml -->
	<template name="button_imagebackpanel_sizedown">
		<button_window_sizedown>
			<anchored position="insidetopright" offset="48,1" />
			<invisible />
		</button_window_sizedown>
	</template>
	<template name="button_imagebackpanel_sizeup">
		<button_window_sizeup>
			<anchored position="insidetopright" offset="32,1" />
			<invisible />
		</button_window_sizeup>
	</template>
	<template name="button_imagefullpanel_sizedown">
		<button_window_sizedown>
			<anchored position="insidetopright" offset="32,1" />
			<invisible />
		</button_window_sizedown>
	</template>
    <template name="button_refresh">
		<button_icon>
			<icon normal="refresh" />
		</button_icon>
	</template>

	<!-- Source: CoreRPG ref/template_ref.xml -->
	<template name="anchor_reftitle">
		<genericcontrol>
			<anchored height="0">
				<top parent="reftitle" anchor="bottom" offset="3" />
				<left parent="" anchor="left" offset="35" />
				<right parent="" anchor="right" offset="-50" />
			</anchored>
			<disabled />
		</genericcontrol>
	</template>
	<template name="frame_ref_content">
		<genericcontrol name="contentframe">
			<anchored>
				<top parent="header" anchor="bottom" offset="15" />
				<left offset="15" />
				<right offset="-25" />
				<bottom offset="-15" />
			</anchored>
			<disabled />
		</genericcontrol>
	</template>
	<template name="sub_ref_header">
		<subwindow>
			<anchored>
				<top offset="10" />
				<left offset="10" />
				<right offset="-25" />
			</anchored>
			<frame name="headergray" offset="6,3,6,3" />
			<activate />
			<fastinit />
		</subwindow>
	</template>
	<template name="button_refmanual_content_copy">
		<button_listitem_icon_framed_right>
			<icon normal="content_copy" />
			<tooltip textres="record_copy" />
			<gmvisibleonly />
			<script>
				function onButtonPress()
					ReferenceManualManager.performPageCopy(window);
				end
			</script>
		</button_listitem_icon_framed_right>
	</template>
	<template name="button_refmanual_content_paste">
		<button_listitem_icon_framed_right>
			<icon normal="content_paste" />
			<tooltip textres="record_paste" />
			<invisible />
			<script>
				function onInit()
					super.onInit();
					if Session.IsHost then
						ReferenceManualManager.registerPagePasteCallback(self.onPasteCallback);
					end
				end
				function onClose()
					if Session.IsHost then
						ReferenceManualManager.unregisterPagePasteCallback(self.onPasteCallback);
					end
				end
				function onPasteCallback()
					self.update();
				end
				function update()
					local bReadOnly = WindowManager.getReadOnlyState(window.getDatabaseNode());
					local bCanPaste = ReferenceManualManager.hasPagePasteRecord();
					setVisible(bCanPaste and not bReadOnly);
				end
				function onButtonPress()
					ReferenceManualManager.performPagePaste(window.parentcontrol.window.content.subwindow);
				end
			</script>
		</button_listitem_icon_framed_right>
	</template>
	<template name="button_refmanual_content_revert">
		<button_listitem_icon_framed_right>
			<icon normal="refresh" />
			<tooltip textres="record_revert" />
			<invisible />
			<script file="ref/scripts/ref_revert.lua" />
		</button_listitem_icon_framed_right>
	</template>
	<template name="button_expand">
		<button_icon>
			<icon normal="button_expand_w" />
			<tooltip textres="tooltip_expand" />
			<target>grouplist,list</target>
			<expand />
			<script file="common/scripts/button_expand_collapse.lua" />
		</button_icon>
	</template>
	<template name="button_collapse">
		<button_icon>
			<icon normal="button_collapse_w" />
			<tooltip textres="tooltip_collapse" />
			<target>grouplist,list</target>
			<collapse />
			<script file="common/scripts/button_expand_collapse.lua" />
		</button_icon>
	</template>

	<!-- CALENDAR -->
	<!-- Source: utility/utility_calendar.xml -->
	<windowclass name="calendar_day" merge="join">
		<script>
			local fSetState;
			function onInit()
				local root = super;
				while root.super do
					root = root.super;
				end
				if root then
					fSetState = root.setState;
					root.setState = updatedSetState;
				end

				if super.onInit then
					super.onInit();
				end
			end
			function onClose()
				super.setState = fSetState;
			end

			function updatedSetState(bCurrDay, bSelDay, bHoliday, nodeEvent)
				fSetState(bCurrDay, bSelDay, bHoliday, nodeEvent);
				if bCurrDay then
					setBackColor(ColorManager.COLOR_CALENDAR_BACKGROUND);
					label_day.setColor(ColorManager.COLOR_PRIMARY_FOREGROUND);
				else
					setBackColor();
					if bHoliday then
						label_day.setColor(ColorManager.COLOR_CALENDAR_HOLIDAY);
					else
						label_day.setColor(ColorManager.COLOR_SECONDARY_FOREGROUND);
					end
				end
			end
		</script>
	</windowclass>
	<windowclass name="calendar_main" merge="join">
		<script>
			local fUpdateDisplay;
			function onInit()
				fUpdateDisplay = super.updateDisplay;
				super.updateDisplay = updateDisplay2;
				
				if super.onInit then
					super.onInit();
				end
			end
			function onClose()
				super.updateDisplay = fUpdateDisplay
			end

			function updateDisplay2()
				fUpdateDisplay();

				local nCampaignMonth = DB.getValue("calendar.current.month", 0);
				for _,v in pairs(list.getWindows()) do
					local nMonth = v.month.getValue();
					local bCampaignMonth = nMonth == nCampaignMonth;

					if bCampaignMonth then
						v.label_period.setColor(ColorManager.COLOR_CALENDAR_MONTH);
					else
						v.label_period.setColor(ColorManager.COLOR_PRIMARY_FOREGROUND);
					end
				end
			end
		</script>
	</windowclass>
	<windowclass name="calendar_main_date" merge="join">
		<sheetdata>
			<stringc_static name="viewdate" merge="join">
				<color>FFF0CA</color> <!-- Replaceable Color: Primary Foreground -->
			</stringc_static>
			<basicnumber name="currentyear" merge="join">
				<color>FFF0CA</color> <!-- Replaceable Color: Primary Foreground -->
			</basicnumber>
			<basicstring name="currentepoch" merge="join">
				<color>FFF0CA</color> <!-- Replaceable Color: Primary Foreground -->
			</basicstring>
			<label name="currenthour" merge="join">
				<color>FFF0CA</color> <!-- Replaceable Color: Primary Foreground -->
			</label>
			<label name="currentminute" merge="join">
				<color>FFF0CA</color> <!-- Replaceable Color: Primary Foreground -->
			</label>
			<label name="currentphase" merge="join">
				<color>FFF0CA</color> <!-- Replaceable Color: Primary Foreground -->
			</label>
		</sheetdata>
	</windowclass>
	
	<!-- Source: Campaign/record_image.xml -->
	<!-- Modify the radial menu to add a distinction between the share group and shared icon -->
	<!-- This whole thing is super cludgy, since I can't find any place in CoreRPG that defines menu option 7,5 on images, which is the unshare options -->
	<!-- Yet it's still there and works. Probably hardcoded and buried. -->
	<string name="imagesizefill">Zoom To Fill</string>
	<string name="imagesizefit">Zoom To Fit</string>
	<string name="image_grid_hexrow">Hex Row Grid</string>
	<string name="image_grid_hexcolumn">Hex Column Grid</string>
	<string name="image_grid_square">Squre Grid</string>
	<string name="image_grid_isometric">Isometric Grid</string>
	<windowclass name="imagewindow" merge="join" version="&gt;=4">
		<script>
			function onInit()
				if super and super.onInit then
					super.onInit()
				end
				registerMenuItem(Interface.getString("windowshare"), "windowsharegroup", 7);
				registerMenuItem(Interface.getString("windowshare"), "windowshare", 7, 7);
				registerMenuItem(Interface.getString("windowunshare"), "windowunshare", 7, 5);

				registerMenuItem(Interface.getString("imagesizefill"), "imagesizefill", 3, 4);

				registerMenuItem(Interface.getString("imagesizefill"), "imagesizefill", 3, 4);

				registerMenuItem(Interface.getString("image_grid_isometric"), "image_grid_isometric", 4, 6, 4);
				registerMenuItem(Interface.getString("image_grid_square"), "image_grid_square", 4, 6, 5);
				registerMenuItem(Interface.getString("image_grid_hexcolumn"), "image_grid_hexcolumn", 4, 6, 6);
				registerMenuItem(Interface.getString("image_grid_hexrow"), "image_grid_hexrow", 4, 6, 7);
			end

			function onMenuSelection(item, subitem)
				if super and super.onMenuSelection then
					super.onMenuSelection(item, subitem)
				end
				if item == 7 then
					if subitem == 5 then
						if not Session.IsHost then return; end
						local node = getDatabaseNode()
						if node.isPublic() then
							node.setPublic(false);
						else
							node.removeAllHolders(true);
						end
					end
				end
			end
		</script>
	</windowclass>

	<!-- Source: campaign/campaign_chars.xml -->
	<windowclass name="charselect_host_entry" merge="join">
		<script>
			function onInit()
				super.onInit();

				registerMenuItem(string.format(Interface.getString("char_menu_ownergm"), User.getUsername()), "icon_take_ownership", 3);
			end
		</script>
	</windowclass>


	<!-- Re-color is moved to script instead of xml to support rulesets that don't use the temphp box -->
	<windowclass name="charsheet_main" merge="join">
		<script file="rulesets/scripts/charsheet_main_colors.lua" />
	</windowclass>
	<!-- Source: ct/ct_host.xml -->
	<!-- Re-color is moved to script instead of xml to support rulesets that don't use the temphp box -->
	<windowclass name="ct_entry" merge="join">
		<script file="rulesets/scripts/ct_entry_colors.lua" />
	</windowclass>
	<windowclass name="client_ct_entry" merge="join">
		<script file="rulesets/scripts/ct_entry_colors.lua" />
	</windowclass>
    
    <!-- Chat window padding adjustments. Source: template_windows.xml -->
    <template name="anchor_content_chatbox_top">
        <genericcontrol name="contentanchor">
            <anchored height="0">
                <top offset="8" />
                <left offset="16" />
                <right offset="-20" />
            </anchored>
            <disabled />
        </genericcontrol>
    </template>

	<template name="anchor_content_chatbox_bottom">
		<genericcontrol name="bottomanchor">
			<anchored to="contentanchor" height="10">
				<bottom parent="" />
				<left />
				<right />
			</anchored>
			<disabled />
		</genericcontrol>
	</template>
</root>
